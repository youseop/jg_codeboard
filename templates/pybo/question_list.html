{% extends 'base.html' %}
{#{% load pybo_filter %}#}
{% block content %}
    <!-- -------------------------------------- [edit] ------------------------------------------ -->
    <div class="col-2">
        <select class="form-control so">
            <option value="recent" {% if so == 'recent' %}selected{% endif %}>최신순</option>
            <option value="recommand" {% if so == 'recommand' %}selected{% endif %}>추천순</option>
            <option value="popular" {% if so == 'popular' %}selected{% endif %}>인기순</option>
        </select>
    </div>

    <div>
        <input type="text" class="form-control kw" value="{{ kw|default_if_none:'' }}">
        <div>
            <button class="btn" type="button" id="btn_search">찾기</button>
        </div>
    </div>

    {% if question_list %}
        <ul>
            {% for question in question_list %}
                <li><a href="{% url 'pybo:detail' question.id %}">{{ question.subject}}</a></li>
                {% if question.answer_set.count > 0 %}
                    <span>답변개수: {{ question.answer_set.count }}</span>
                {% endif %}
                <td>{{ question.author.username }}</td>
                <td>{{ question.create_date }}</td>
            {% endfor %}
        </ul>
        <!-- 페이지 처리 시작 -->
        <ul class="pagination">
            {% if question_list.has_previous %}
                <li class="page-item">
                    <a class="page-link" data_page="{{ question_list.previous_page_number }}" href="#">이전</a>
                </li>
            {% else %}
                <li class="page-item disabled">
                    <a class="page-link" tabindex="-1" aria-disabled="true" href="#">이전</a>
                </li>
            {% endif %}
            <!-- 페이지 리스트 -->
            {% for page_number in question_list.paginator.page_range %}
                {% if page_number >= question_list.number|add:-5 and page_number <= question_list.number|add:5 %}
                    <!-- 이부분 이해가 안됨 ㅎ -->
                    {% if page_number == question_list.number %}
                        <li class="page-item active" aira-current="page">
                            <a class="page-link" data-page="{{ page_number }}" href="#">{{ page_number }}</a>
                        </li>
                    {% else %}
                        <li class="page-item">
                            <a class="page-link" data-page="{{ page_number }}" href="#">{{ page_number }}</a>
                        </li>
                    {% endif %}
                {% endif %}
            {% endfor %}
            <!-- 다음페이지 -->
            {% if question_list.has_next %}
                <li class="page-item">
                    <a class="page-link" data-page="{{ question_list.next_page_number }}" href="#">다음</a>
                </li>
            {% else %}
                <li class="page-item disabled">
                    <a class="page-link" tabindex="-1" aria-disabled="true" href="#">다음</a>
                </li>
            {% endif %}
        </ul>

    {% else %}
        <p>질문이 없습니다.</p>
    {% endif %}
    <a href="{% url 'pybo:question_create' %}" class="btn">질문 등록하기</a>
    <!-- # -------------------------------------- [edit] ------------------------------------------ -->
    <form id="searchForm" method="get" action="{% url 'index' %}">
        <input type="hidden" id="kw" name="kw" value="{{ kw|default_if_none:'' }}">
        <input type="hidden" id="page" name="page" value="{{ page }}">
        <input type="hidden" id="so" name="so" value="{{ so }}">
    </form>
{% endblock %}

{% block script %}
    <script type="text/javascript">
        $(document).ready(function (){
            $(".page-link").on('click', function () {
                $("#page").val($(this).data("page"));
                $("#searchForm").submit();
            });

            $("#btn_search").on('click', function() {
                $("#kw").val($(".kw").val());
                $("#page").val(1);
                $("#searchForm").submit();
            });
            $(".so").on('change', function() {
               $("#so").val($(this).val());
               $("#page").val(1);
               $("#searchForm").submit();
            });
        })
    </script>
{% endblock %}